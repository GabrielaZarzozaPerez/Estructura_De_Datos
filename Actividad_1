#Importacion de librerias
import openpyxl
import pandas as pd

#Separador
sep = "\n" + ("*" * 30) + "\n"

#Creacion de listas
Reprobados = []
conca = []

#Creacion de "Switches"
Calificaciones = True
Check = True

#Variable usada como contador
k = 2

#Creacion de la hoja en excel
libro = openpyxl.Workbook()
hoja = libro["Sheet"]
hoja.title = "Calificaciones"
hoja["A1"].value = "Alumno"
print("Ingresa las materias del curso\n")
hoja["B1"].value = input("Materia numero 1\n")
hoja["C1"].value = input("\nMateria numero 2\n")
hoja["D1"].value = input("\nMateria numero 3\n")
hoja["E1"].value = input("\nMateria numero 4\n")
hoja["F1"].value = input("\nMateria numero 5\n")
libro.save("Lista.xlsx")

#Lectura del archivo en excel con las materias
libro = openpyxl.load_workbook("Lista.xlsx")
hoja = libro["Calificaciones"]

#Cantidad de alumnos a ingresar
Cantidad = 30     

#Ciclo para ingresar los nombres de los alumnos
for a in range(Cantidad):
    print(f"\nIngresa el nombre del alumno numero {a+1}:")
    Nombre = input()
    hoja.cell(row=k, column=1).value = Nombre
    print(sep)
    k = k + 1

print(f"Alumnos registrados\n{sep}\n")

#Ciclo para ingresar las calificaciones de los alumnos
k = 2
while Calificaciones == True:
    if k == (Cantidad+2):
        Calificaciones = False
    else:
        j = 2
        for i in range(5):
            Calificacion = int(input(f"\nAlumno {k-1}: {hoja.cell(row=k, column=1).value}\nMateria: {hoja.cell(row=1, column=j).value}\nCalificacion: "))
            hoja.cell(row=k, column=j).value = Calificacion
            j = j + 1
        libro.save("Lista.xlsx")
        print(sep)
        k = k + 1


print(f"Calificaciones registradas\n")

#Creacion de los dataframes
data = pd.read_excel("Lista.xlsx")
prom = pd.DataFrame(data.mean(axis=0)) #Dataframe con los promedios por materia

print(f"Promedios por materia:\n{prom.sort_values(0,ascending = True)}")
print("\nLas materias estan ordenadas de menor a mayor de acuerdo al rendimiento de los estudiantes\n")

#Ciclo para buscar alumnos con dos o mas materias reprobadas, los nombres de los alumnos reprobados se guardan en una lista
k = 2
while Check == True:
    if k == (Cantidad+2):
        Check = False
    else:
        j = 2
        contador = 0
        for h in range(5):
            if hoja.cell(row=k, column=j).value < 70:
                contador = contador + 1
                if contador >= 2:
                    Reprobados.append(hoja.cell(row=k, column=1).value)
                    break
                else:
                    j = j + 1
            else:
                j = j + 1
        k = k + 1
        
print("\nAlumnos con dos o mas materias reprobadas:\n")

#Creacion de un nuevo dataframe a partir de la busqueda de los nombres en la lista de los alumnos reprobados, se busca el nombre en el
#dataframe raiz y se guarda el resultado, al final se concatenan los resultados en un nuevo script
for p in range(len(Reprobados)):
    Nombre = Reprobados[p]
    conca.append(pd.DataFrame(data.loc[data['Alumno'] == Nombre]))
    newdata = pd.concat(conca)
    
print(newdata)

#Pregunta al usuario si desea ver la lista de alumnos completa
Desic = int(input("\nÂ¿Desea ver la lista completa de estudiantes?\n1.- SI\n2.- NO\n"))
if Desic == 1:
    print(data)
    print("\nQue tenga un buen dia")
else:
    print("\nQue tenga un buen dia")
